(()=>{function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(a){return typeof a}:function(a){return a&&"function"==typeof Symbol&&a.constructor===Symbol&&a!==Symbol.prototype?"symbol":typeof a},a(t)}function t(t,e,d){var o;return o=function(t,e){if("object"!=a(t)||!t)return t;var d=t[Symbol.toPrimitive];if(void 0!==d){var o=d.call(t,e||"default");if("object"!=a(o))return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===e?String:Number)(t)}(e,"string"),(e="symbol"==a(o)?o:o+"")in t?Object.defineProperty(t,e,{value:d,enumerable:!0,configurable:!0,writable:!0}):t[e]=d,t}var e,d,o=JSON.parse(document.currentScript.getAttribute("data-params")),i='<div class="dashboard-widget-tools d-flex justify-content-center"><i class="fa-solid fa-trash-can" data-action="line-remove"></i></div>',s='<div class="d-line-break line-edit">'+i+"</div>",n='<div id="placeholder" class="d-none"></div',r=function(){var a=[];$("[data-widget-name]").each((function(t,e){return a.push($(e).data("widget-name"))})),$.ajax({url:o.modal_route,type:"post",data:{widgets:a},success:function(a){e=bootbox.dialog({message:a,size:"large",onHide:function(){$("#placeholder").remove()}})}})},c=function(){$("#toggle-dashboard").data("status","unlocked").removeClass("btn-outline-secondary").addClass("btn-danger").children().toggleClass("fa-lock fa-lock-open"),$("#dashboard-widgets").append('<div class="dashboard-buttons d-flex flex-column justify-content-between"><button class="btn btn-outline-secondary btn-sm mb-2" data-action="select-widget"><i class="fa-solid fa-plus fa-fw"></i></button><button class="btn btn-outline-secondary btn-sm" data-action="dashboard-add-line"><i class="fa-solid fa-fw fa-rotate-180 fa-share"></i></i></button></div>'),$(".d-line-break").addClass("line-edit").html(i),$(".dashboard-widget").prepend('<div class="dashboard-widget-tools d-flex flex-column justify-content-between"><div class="d-flex justify-content-between"><i class="fa fa-solid fa-square-plus" data-action="add-before"></i><i class="fa fa-solid fa-square-plus" data-action="add-after"></i></div><div class="d-flex justify-content-center"><i class="fa-solid fa-wrench mr-3 d-none" data-action="settings"></i><i class="fa-solid fa-trash-can" data-action="remove"></i></div><div class="d-flex justify-content-between align-items-center"><span><i class="fa-solid fa-square-caret-left" data-action="move-left"></i>&nbsp;<i class="fa-solid fa-square-caret-right" data-action="move-right"></i></span><span><i class="fa-solid fa-share fa-rotate-180" data-action="new-line"></i></span></div></div>'),$(".d-line-break").prev(".dashboard-widget").find('[data-action="new-line"]').remove(),$(".dashboard-buttons").prev(".dashboard-widget").find('[data-action="new-line"],[data-action="move-right"],[data-action="add-after"]').remove(),0===$(".dashboard-widget").length&&$('[data-action="dashboard-add-line"]').addClass("d-none"),$(".dashboard-buttons").prev().hasClass("d-line-break")&&$('.dashboard-buttons [data-action="dashboard-add-line"]').remove(),$("#dashboard-widgets .dashboard-widget:first-child").find('[data-action="move-left"]').remove(),$("#dashboard-widgets .dashboard-widget:first-child").next().hasClass("d-line-break")&&$("#dashboard-widgets .dashboard-widget:first-child").find('[data-action="move-right"]').remove(),$("#dashboard-widgets div:first-child").hasClass("d-line-break")&&$("#dashboard-widgets div:first-child").remove(),$('#dashboard-widgets .dashboard-widget[data-widget-edit="yes"]').find('[data-action="settings"]').removeClass("d-none")},l=function(){$("#toggle-dashboard").data("status","locked").removeClass("btn-danger").addClass("btn-outline-secondary").children().toggleClass("fa-lock fa-lock-open"),$(".dashboard-widget-tools").remove(),$(".d-line-break").removeClass("line-edit"),$(".dashboard-buttons").remove()},u=function(){var a;l(),c(),a=[],$("#dashboard-widgets > div.dashboard-widget, #dashboard-widgets > div.d-line-break").each((function(e,d){var o=$(d).data("widget-name");if(void 0!==o){var i=t({},o,$(d).data("widget-parameters")||{});a.push(i)}else a.push({"line-break":{}})})),$.ajax({url:o.save_widgets,type:"post",data:{widgets:JSON.stringify(a)}})};$("#toggle-dashboard").on("click",(function(){"locked"===$(this).data("status")?c():l()})),$((function(){"unlocked"===$("#toggle-dashboard").data("status")&&c()})),$(document).on("click",'[data-action="select-widget"]',(function(){$(".dashboard-buttons").before(n),r()})),$(document).on("click",'[data-action="add-after"]',(function(){$(this).closest(".dashboard-widget").after(n),r()})),$(document).on("click",'[data-action="add-before"]',(function(){$(this).closest(".dashboard-widget").before(n),r()})),$(document).on("click",'.dashboard-widget-tools [data-action="move-right"]',(function(){var a=$(this).closest(".dashboard-widget");a.next().after(a),u()})),$(document).on("click",'.dashboard-widget-tools [data-action="move-left"]',(function(){var a=$(this).closest(".dashboard-widget");a.prev().before(a),u()})),$(document).on("click",'[data-action="add-widget"]',(function(){$.ajax({url:o.load_widget,type:"post",data:{slug:$(this).attr("data-slug")},success:function(a){$("#placeholder").replaceWith(a),u(),e.modal("hide")}})})),$(document).on("click",'[data-action="settings"]',(function(){$.ajax({url:o.edit_widget,type:"post",data:{slug:$(this).closest(".dashboard-widget").attr("data-widget-name")},success:function(a){d=bootbox.dialog({message:a,size:"large",closeButton:!1})}})})),$(document).on("click",'[data-action="update-widget"]',(function(a){a.preventDefault(),a.stopPropagation(),$.ajax({url:o.update_widget,type:"post",data:$(this).closest("form").serialize(),success:function(a){!1===a.success?$("#widget-edition-form").html(a.view):($('[data-widget-name="'+a.slug+'"]').html(a.widget).data("widget-parameters",JSON.parse(a.settings)),u(),d.modal("hide"))}})})),$(document).on("click",'[data-action="undo-update"]',(function(){d.modal("hide")})),$(document).on("click",'.dashboard-widget-tools [data-action="remove"]',(function(){$(this).closest(".dashboard-widget").remove(),u()})),$(document).on("click","[data-action=remove-widget]",(function(){$('[data-widget-name="'+$(this).data("slug")+'"]').remove(),u(),e.modal("hide")})),$(document).on("click",'.dashboard-widget-tools [data-action="new-line"]',(function(){$(this).closest(".dashboard-widget").after(s),u()})),$(document).on("click",'[data-action="dashboard-add-line"]',(function(){$(".dashboard-buttons").before(s),u()})),$(document).on("click",'[data-action="line-remove"]',(function(){$(this).closest(".d-line-break").remove(),u()}))})();